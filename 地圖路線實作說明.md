# åœ°åœ–è·¯ç·šå¯¦ä½œèªªæ˜

## ğŸ“ ç³»çµ±ä½¿ç”¨å…©ç¨®æ–¹å¼ç”Ÿæˆåœ°åœ–è·¯ç·š

### æ–¹å¼ä¸€ï¼šç°¡å–®ç›´ç·šé€£æ¥ï¼ˆå–®ç­†è¨ˆç®—ä½¿ç”¨ï¼‰

**ä½¿ç”¨å ´æ™¯ï¼š** `/api/calculate/distance` å–®ç­†è¨ˆç®—

**å¯¦ä½œæ–¹æ³•ï¼š** `download_static_map()`

**æµç¨‹ï¼š**
1. ä½¿ç”¨ **Geocoding API** å°‡åœ°å€è½‰æ›ç‚ºç¶“ç·¯åº¦åº§æ¨™
2. ä½¿ç”¨ **Static Maps API** å»ºç«‹åœ°åœ– URLï¼š
   ```
   https://maps.googleapis.com/maps/api/staticmap?
   size=800x600&
   markers=color:red|label:S|{èµ·é»ç·¯åº¦},{èµ·é»ç¶“åº¦}&
   markers=color:green|label:E|{çµ‚é»ç·¯åº¦},{çµ‚é»ç¶“åº¦}&
   path=color:0x0000ff|weight:5|{èµ·é»ç·¯åº¦},{èµ·é»ç¶“åº¦}|{çµ‚é»ç·¯åº¦},{çµ‚é»ç¶“åº¦}&
   key={API_KEY}
   ```
3. ä¸‹è¼‰åœ°åœ–åœ–ç‰‡ä¸¦å„²å­˜

**ç‰¹é»ï¼š**
- âœ… é€Ÿåº¦å¿«
- âŒ åªé¡¯ç¤ºèµ·é»å’Œçµ‚é»çš„ç›´ç·šé€£æ¥
- âŒ ä¸é¡¯ç¤ºå¯¦éš›é“è·¯è·¯ç·š

---

### æ–¹å¼äºŒï¼šå®Œæ•´è·¯ç·š Polylineï¼ˆæ‰¹æ¬¡è¨ˆç®—ä½¿ç”¨ï¼‰â­ **æ¨è–¦**

**ä½¿ç”¨å ´æ™¯ï¼š** `/api/calculate/batch` æ‰¹æ¬¡è¨ˆç®—

**å¯¦ä½œæ–¹æ³•ï¼š** `get_route_detail()` + `download_static_map_with_polyline()`

**æµç¨‹ï¼š**

#### æ­¥é©Ÿ 1ï¼šå–å¾—å¯¦éš›è·¯ç·šè³‡è¨Š
ä½¿ç”¨ **Directions API** å–å¾—å®Œæ•´è·¯ç·šï¼š
```python
directions_result = self.gmaps.directions(
    origin_address,
    dest_address,
    mode='driving',
    language='zh-TW'
)
```

**å–å¾—è³‡æ–™ï¼š**
- âœ… å¯¦éš›é“è·¯è·¯ç·šçš„ **polyline**ï¼ˆè·¯ç·šç·¨ç¢¼ï¼‰
- âœ… é€æ­¥å°èˆªæŒ‡ç¤ºï¼ˆstepsï¼‰
- âœ… ç¸½è·é›¢å’Œæ™‚é–“
- âœ… è·¯ç·šè©³ç´°è³‡è¨Š

#### æ­¥é©Ÿ 2ï¼šä½¿ç”¨ Polyline ç”Ÿæˆåœ°åœ–
ä½¿ç”¨ **Static Maps API** é…åˆ polyline é¡¯ç¤ºå®Œæ•´è·¯ç·šï¼š
```
https://maps.googleapis.com/maps/api/staticmap?
size=800x600&
path=enc:{polylineç·¨ç¢¼}&
key={API_KEY}
```

**ç‰¹é»ï¼š**
- âœ… é¡¯ç¤º**å¯¦éš›é“è·¯è·¯ç·š**ï¼ˆä¸æ˜¯ç›´ç·šï¼‰
- âœ… è·¯ç·šæœƒæ²¿è‘—çœŸå¯¦é“è·¯ç¹ªè£½
- âœ… å¯ä»¥åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºå…¬é‡Œæ•¸
- âœ… åŒ…å«å®Œæ•´çš„å°èˆªæ­¥é©Ÿè³‡è¨Š

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### Polyline æ˜¯ä»€éº¼ï¼Ÿ

**Polyline** æ˜¯ Google Maps ç”¨ä¾†ç·¨ç¢¼è·¯ç·šçš„æ ¼å¼ï¼Œå®ƒå°‡è¤‡é›œçš„è·¯ç·šåº§æ¨™å£“ç¸®æˆä¸€å€‹å­—ä¸²ã€‚

**ç¯„ä¾‹ï¼š**
```
åŸå§‹è·¯ç·šï¼šå¤šå€‹ç¶“ç·¯åº¦é»
(25.0330, 121.5654) â†’ (25.0340, 121.5664) â†’ (25.0350, 121.5674) ...

ç·¨ç¢¼å¾Œï¼šä¸€å€‹å­—ä¸²
"abcxyz123..." (polyline ç·¨ç¢¼)
```

### ç‚ºä»€éº¼ä½¿ç”¨ Polylineï¼Ÿ

1. **ç¯€çœ API è«‹æ±‚å¤§å°**ï¼šä¸éœ€è¦å‚³é€å¤§é‡åº§æ¨™é»
2. **é¡¯ç¤ºçœŸå¯¦è·¯ç·š**ï¼šè·¯ç·šæœƒæ²¿è‘—å¯¦éš›é“è·¯ç¹ªè£½
3. **ç²¾ç¢ºåº¦é«˜**ï¼šè·¯ç·šèˆ‡ Google Maps å°èˆªä¸€è‡´

---

## ğŸ“Š å…©ç¨®æ–¹å¼å°æ¯”

| é …ç›® | æ–¹å¼ä¸€ï¼ˆç›´ç·šï¼‰ | æ–¹å¼äºŒï¼ˆPolylineï¼‰ |
|------|---------------|-------------------|
| **API ä½¿ç”¨** | Geocoding + Static Maps | Directions + Static Maps |
| **è·¯ç·šé¡¯ç¤º** | èµ·é»åˆ°çµ‚é»ç›´ç·š | å¯¦éš›é“è·¯è·¯ç·š |
| **é€Ÿåº¦** | å¿« | è¼ƒæ…¢ï¼ˆéœ€è¦è¨ˆç®—è·¯ç·šï¼‰ |
| **æº–ç¢ºåº¦** | ä½ï¼ˆç›´ç·šè·é›¢ï¼‰ | é«˜ï¼ˆå¯¦éš›é“è·¯è·é›¢ï¼‰ |
| **ä½¿ç”¨å ´æ™¯** | å–®ç­†å¿«é€Ÿè¨ˆç®— | æ‰¹æ¬¡å®Œæ•´è¨ˆç®— |
| **æˆæœ¬** | è¼ƒä½ | è¼ƒé«˜ï¼ˆDirections API è¨ˆè²»è¼ƒé«˜ï¼‰ |

---

## ğŸ¯ ç›®å‰ç³»çµ±å¯¦ä½œ

### æ‰¹æ¬¡è¨ˆç®—ï¼ˆä¸»è¦åŠŸèƒ½ï¼‰

```python
# 1. å–å¾—è©³ç´°è·¯ç·šï¼ˆåŒ…å« polylineï¼‰
route_detail = maps_service.get_route_detail(origin, destination)

# 2. ä½¿ç”¨ polyline ç”Ÿæˆåœ°åœ–
map_image = maps_service.download_static_map_with_polyline(
    polyline=route_detail['polyline'],
    origin_address=origin,
    destination_address=destination,
    distance_km=route_detail['distance_km']  # æœƒé¡¯ç¤ºåœ¨åœ°åœ–ä¸Š
)
```

**çµæœï¼š**
- âœ… åœ°åœ–é¡¯ç¤ºå¯¦éš›é“è·¯è·¯ç·š
- âœ… åœ°åœ–å·¦ä¸Šè§’é¡¯ç¤ºå…¬é‡Œæ•¸
- âœ… è·¯ç·šæ²¿è‘—çœŸå¯¦é“è·¯ç¹ªè£½

---

## ğŸ“ ç›¸é—œ API

### Google Maps Directions API
- **ç”¨é€”**ï¼šè¨ˆç®—è·¯ç·šã€å–å¾—å°èˆªæŒ‡ç¤º
- **å›å‚³**ï¼šè·¯ç·šè³‡è¨Šã€polylineã€è·é›¢ã€æ™‚é–“ã€æ­¥é©Ÿ

### Google Maps Static Maps API
- **ç”¨é€”**ï¼šç”Ÿæˆéœæ…‹åœ°åœ–åœ–ç‰‡
- **æ”¯æ´**ï¼šmarkersï¼ˆæ¨™è¨˜ï¼‰ã€pathï¼ˆè·¯ç·šï¼‰ã€polylineï¼ˆç·¨ç¢¼è·¯ç·šï¼‰

### Google Maps Geocoding API
- **ç”¨é€”**ï¼šåœ°å€è½‰æ›ç‚ºç¶“ç·¯åº¦
- **ä½¿ç”¨å ´æ™¯**ï¼šç°¡å–®åœ°åœ–ç”Ÿæˆ

---

## ğŸ’¡ å»ºè­°

**ç›®å‰ç³»çµ±å·²ä½¿ç”¨æ–¹å¼äºŒï¼ˆPolylineï¼‰é€²è¡Œæ‰¹æ¬¡è¨ˆç®—**ï¼Œé€™æ˜¯æ­£ç¢ºçš„åšæ³•ï¼Œå› ç‚ºï¼š

1. âœ… é¡¯ç¤ºçœŸå¯¦è·¯ç·šï¼ˆä¸æ˜¯ç›´ç·šï¼‰
2. âœ… è·¯ç·šèˆ‡ Google Maps å°èˆªä¸€è‡´
3. âœ… å¯ä»¥å–å¾—è©³ç´°å°èˆªæ­¥é©Ÿ
4. âœ… åœ°åœ–ä¸Šå¯ä»¥é¡¯ç¤ºå…¬é‡Œæ•¸

å¦‚æœéœ€è¦å„ªåŒ–ï¼Œå¯ä»¥è€ƒæ…®ï¼š
- å¿«å–ç›¸åŒè·¯ç·šçš„ polylineï¼ˆæ¸›å°‘ API å‘¼å«ï¼‰
- æ‰¹æ¬¡è™•ç†æ™‚ä½¿ç”¨ç•°æ­¥è«‹æ±‚ï¼ˆåŠ å¿«é€Ÿåº¦ï¼‰





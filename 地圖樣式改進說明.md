# Google Maps å®˜æ–¹æ¨£å¼åœ°åœ–æ”¹é€²èªªæ˜

## âœ… å·²å®Œæˆçš„æ”¹é€²

### 1. ä½¿ç”¨ Google Maps å®˜æ–¹æ¨£å¼

**ä¿®æ”¹æª”æ¡ˆï¼š** `backend/services/google_maps_service.py`

#### ä¸»è¦æ”¹é€²ï¼š

1. **å®˜æ–¹é“è·¯åº•åœ–**
   - ä½¿ç”¨ `maptype=roadmap` åƒæ•¸
   - ç¢ºä¿ä½¿ç”¨ Google Maps å®˜æ–¹çš„é“è·¯æ¨£å¼

2. **ä¸»è¦è·¯ç·šæ¨£å¼**
   - é¡è‰²ï¼š`#4285F4`ï¼ˆGoogle Maps å®˜æ–¹è—è‰²ï¼‰
   - ç²—ç´°ï¼š`weight=6`ï¼ˆç¬¦åˆç¶²é ç‰ˆä¸»è¦è·¯ç·šï¼‰
   - å¡«å……ï¼šåŠé€æ˜è—è‰² `fillcolor:0x4285F480`

3. **æ›¿ä»£è·¯ç·šæ”¯æ´**
   - é¡è‰²ï¼š`#808080`ï¼ˆç°è‰²ï¼‰
   - ç²—ç´°ï¼š`weight=4`ï¼ˆè¼ƒç´°ï¼Œç¬¦åˆç¶²é ç‰ˆï¼‰
   - å¡«å……ï¼šåŠé€æ˜ç°è‰² `fillcolor:0x80808040`

4. **èµ·é»/çµ‚é»æ¨™è¨˜**
   - èµ·é»ï¼šç´…è‰²æ¨™è¨˜ï¼ˆ`color:0xFF0000`ï¼Œæ¨™ç±¤ Aï¼‰
   - çµ‚é»ï¼šç¶ è‰²æ¨™è¨˜ï¼ˆ`color:0x00FF00`ï¼Œæ¨™ç±¤ Bï¼‰

### 2. æ”¯æ´æ›¿ä»£è·¯ç·š

**ä¿®æ”¹æª”æ¡ˆï¼š** `backend/services/google_maps_service.py`

- `get_route_detail()` æ–¹æ³•ç¾åœ¨æ”¯æ´ `alternatives=True` åƒæ•¸
- æœƒå¾ Directions API ç²å–ä¸»è¦è·¯ç·šå’Œæ›¿ä»£è·¯ç·š
- è¿”å› `alternative_polylines` åˆ—è¡¨

### 3. æ›´æ–°åœ°åœ–ç”Ÿæˆæµç¨‹

**ä¿®æ”¹æª”æ¡ˆï¼š** `backend/routes/calculate.py`

- èª¿ç”¨ `get_route_detail()` æ™‚å‚³å…¥ `alternatives=True`
- å°‡æ›¿ä»£è·¯ç·šå‚³éçµ¦ `download_static_map_with_polyline()`

## ğŸ¯ æŠ€è¡“å¯¦ç¾ç´°ç¯€

### Static Maps API åƒæ•¸èªªæ˜

```python
# ä¸»è¦è·¯ç·š
path=color:0x4285F4|weight:6|fillcolor:0x4285F480|enc:{polyline}

# æ›¿ä»£è·¯ç·šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
path=color:0x808080|weight:4|fillcolor:0x80808040|enc:{alt_polyline}

# èµ·é»æ¨™è¨˜
markers=color:0xFF0000|label:A|{lat},{lng}

# çµ‚é»æ¨™è¨˜
markers=color:0x00FF00|label:B|{lat},{lng}
```

### é¡è‰²å°ç…§è¡¨

| å…ƒç´  | é¡è‰²ä»£ç¢¼ | èªªæ˜ |
|------|---------|------|
| ä¸»è¦è·¯ç·š | `#4285F4` | Google Maps å®˜æ–¹è—è‰² |
| æ›¿ä»£è·¯ç·š | `#808080` | ç°è‰² |
| èµ·é»æ¨™è¨˜ | `#FF0000` | ç´…è‰² |
| çµ‚é»æ¨™è¨˜ | `#00FF00` | ç¶ è‰² |

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### è‡ªå‹•ä½¿ç”¨

ç•¶èª¿ç”¨ `calculate_batch` API æ™‚ï¼Œç³»çµ±æœƒï¼š

1. ä½¿ç”¨ Directions API ç²å–è·¯ç·šï¼ˆåŒ…å«æ›¿ä»£è·¯ç·šï¼‰
2. å„ªå…ˆä½¿ç”¨ Playwright æˆªåœ–ï¼ˆå¦‚æœå¯ç”¨ï¼‰
3. å¦‚æœ Playwright å¤±æ•—ï¼Œè‡ªå‹•å›é€€åˆ° Google Maps å®˜æ–¹æ¨£å¼éœæ…‹åœ°åœ–
4. éœæ…‹åœ°åœ–æœƒé¡¯ç¤ºï¼š
   - Google Maps å®˜æ–¹é“è·¯åº•åœ–
   - è—è‰²ä¸»è¦è·¯ç·š
   - ç°è‰²æ›¿ä»£è·¯ç·šï¼ˆå¦‚æœæœ‰ï¼‰
   - ç´…è‰²èµ·é»æ¨™è¨˜
   - ç¶ è‰²çµ‚é»æ¨™è¨˜

### æ‰‹å‹•èª¿ç”¨

```python
from services.google_maps_service import GoogleMapsService

maps_service = GoogleMapsService()

# ç²å–è·¯ç·šè©³æƒ…ï¼ˆåŒ…å«æ›¿ä»£è·¯ç·šï¼‰
route_detail = maps_service.get_route_detail(
    origin_address="èµ·é»åœ°å€",
    dest_address="çµ‚é»åœ°å€",
    alternatives=True  # ç²å–æ›¿ä»£è·¯ç·š
)

# ç”Ÿæˆå®˜æ–¹æ¨£å¼åœ°åœ–
map_path = maps_service.download_static_map_with_polyline(
    polyline=route_detail['polyline'],
    origin_address="èµ·é»åœ°å€",
    destination_address="çµ‚é»åœ°å€",
    distance_km=route_detail['distance_km'],
    alternative_polylines=route_detail.get('alternative_polylines', [])
)
```

## ğŸ” èˆ‡ä¹‹å‰çš„å·®ç•°

### ä¹‹å‰ï¼ˆåœ–ä¸€ï¼‰

- âŒ ç°¡å–®çš„ polyline ç·šæ¢
- âŒ æ²’æœ‰å®˜æ–¹é“è·¯æ¨£å¼
- âŒ æ²’æœ‰èµ·é»/çµ‚é»æ¨™è¨˜
- âŒ æ²’æœ‰æ›¿ä»£è·¯ç·š
- âŒ é¡è‰²å’Œæ¨£å¼ä¸ç¬¦åˆ Google Maps

### ç¾åœ¨ï¼ˆåœ–äºŒï¼‰

- âœ… Google Maps å®˜æ–¹é“è·¯åº•åœ–
- âœ… è—è‰²ä¸»è¦è·¯ç·šï¼ˆç¬¦åˆå®˜æ–¹æ¨£å¼ï¼‰
- âœ… ç°è‰²æ›¿ä»£è·¯ç·šï¼ˆå¦‚æœæœ‰ï¼‰
- âœ… ç´…è‰²èµ·é»æ¨™è¨˜
- âœ… ç¶ è‰²çµ‚é»æ¨™è¨˜
- âœ… å®Œå…¨ç¬¦åˆ Google Maps ç¶²é ç‰ˆè¦–è¦ºæ•ˆæœ

## âš ï¸ æ³¨æ„äº‹é …

1. **API é…é¡**ï¼šä½¿ç”¨ Static Maps API æœƒæ¶ˆè€— API é…é¡
2. **URL é•·åº¦é™åˆ¶**ï¼šå¦‚æœæœ‰å¤šæ¢æ›¿ä»£è·¯ç·šï¼ŒURL å¯èƒ½æœƒå¾ˆé•·ï¼ˆGoogle Maps API æœ‰ URL é•·åº¦é™åˆ¶ï¼‰
3. **å›é€€æ©Ÿåˆ¶**ï¼šå¦‚æœå®˜æ–¹æ¨£å¼å¤±æ•—ï¼Œæœƒè‡ªå‹•å›é€€åˆ°ç°¡å–®æ¨£å¼

## ğŸ§ª æ¸¬è©¦å»ºè­°

1. æ¸¬è©¦æœ‰æ›¿ä»£è·¯ç·šçš„æƒ…æ³ï¼ˆä¾‹å¦‚ï¼šåŸå¸‚é–“é•·è·é›¢è·¯ç·šï¼‰
2. æ¸¬è©¦æ²’æœ‰æ›¿ä»£è·¯ç·šçš„æƒ…æ³ï¼ˆä¾‹å¦‚ï¼šçŸ­è·é›¢è·¯ç·šï¼‰
3. æ¸¬è©¦ Playwright æˆªåœ–å¤±æ•—æ™‚çš„å›é€€æ©Ÿåˆ¶
4. é©—è­‰åœ°åœ–æ¨£å¼æ˜¯å¦ç¬¦åˆ Google Maps ç¶²é ç‰ˆ

## ğŸ“ ç›¸é—œæª”æ¡ˆ

- `backend/services/google_maps_service.py` - ä¸»è¦ä¿®æ”¹æª”æ¡ˆ
- `backend/routes/calculate.py` - æ›´æ–°èª¿ç”¨æ–¹å¼
- `backend/services/gmap_screenshot_service.py` - Playwright æˆªåœ–æœå‹™ï¼ˆå„ªå…ˆä½¿ç”¨ï¼‰


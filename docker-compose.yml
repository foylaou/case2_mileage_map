version: '3.8'

services:
  mileage-map:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mileage_map_app
    ports:
      - "5001:5001"
    volumes:
      # 掛載整個專案目錄，方便開發時即時更新
      - .:/app
      # 獨立掛載以下目錄以確保資料持久化
      - ./backend/output:/app/backend/output
      - ./backend/logs:/app/backend/logs
      - ./backend/temp:/app/backend/temp
    environment:
      # DATABASE_URI: 設定連接到 MySQL 服務
      # 格式: mysql+pymysql://<使用者>:<密碼>@<服務名稱>:<端口>/<資料庫名稱>
      - DATABASE_URI=mysql+pymysql://user:password@db:3306/mileage_map
      # 從 .env 檔案讀取其他環境變數 (如果需要的話)
      # - SECRET_KEY=your-secret-key-from-env
      # - JWT_SECRET_KEY=your-jwt-secret-key-from-env
    restart: unless-stopped
#    depends_on:
#      - db
#
#  db:
#    image: mysql:8.0
#    container_name: mileage_map_db
#    ports:
#      # 將主機的 3307 port map 到 container 的 3306 port，避免與本地已安裝的 MySQL 衝突
#      - "3307:3306"
#    environment:
#      MYSQL_DATABASE: mileage_map
#      MYSQL_ROOT_PASSWORD: your_strong_password # 請更換為更安全的密碼
#      MYSQL_USER: user
#      MYSQL_PASSWORD: password
#    volumes:
#      # 掛載初始化腳本
#      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
#      # 掛載資料卷以持久化資料
#      - mysql_data:/var/lib/mysql
#    restart: unless-stopped

volumes:
  mysql_data:

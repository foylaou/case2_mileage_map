# 安全性修補變更日誌

## 2024-12-22 - CORS 安全修補最終調整

### 修改目標
確保 CORS 安全設計與測試邏輯一致，符合資安規範。

### 核心設計原則
- **Path 大小寫敏感性**：只有嚴格的小寫 `/api/*` 路徑允許 CORS
- **大小寫不一致路徑拒絕**：這是設計刻意限制，非漏洞
- **最小權限原則**：僅允許本機前端來源

### 修改的檔案

#### 1. CORS 設定檔案
- **`backend/main.py`**
  - 新增詳細的資安註解說明
  - 說明 CORS 僅允許小寫 `/api/*` 路徑的設計原因
  - 標註修補的 CVE 編號

- **`backend/app.py`**
  - 與 `main.py` 相同的資安註解說明

#### 2. 測試腳本
- **`backend/tests/test_cors_security.py`**
  - 調整 Path 大小寫測試邏輯
  - 將大小寫不一致路徑的拒絕行為視為 PASS（預期行為）
  - 在測試輸出中標示 "Expected Reject"
  - 新增安全說明註解

#### 3. 文件
- **`backend/SECURITY.md`** (新增)
  - 完整的資安修補說明
  - Path 大小寫敏感性的設計說明
  - 稽核注意事項

- **`backend/SECURITY_PATCHES.md`** (更新)
  - 更新安全性檢查腳本路徑
  - 新增重要說明

- **`backend/tests/README.md`** (更新)
  - 更新測試說明
  - 說明 Path 大小寫不一致路徑的預期行為

### 測試驗證

執行安全性測試：
```bash
cd backend
python tests/test_cors_security.py
```

**預期結果：**
- 所有測試應該通過（PASS）
- 大小寫不一致路徑測試會標示為 "Expected Reject"
- 測試總結會說明這是預期的安全行為

### 資安稽核要點

1. **Path 大小寫不一致的 CORS 行為是設計刻意限制，非漏洞**
   - 這是為了修補 CVE-2024-6866 而採用的安全設計
   - 測試腳本會將此行為標示為 "Expected Reject"

2. **所有 CVE 已修補**
   - CVE-2024-6221: 白名單 origins
   - CVE-2024-1681: 日誌清理
   - CVE-2024-6866: 大小寫敏感路徑匹配
   - CVE-2024-6844: '+' 字元處理

3. **設計符合最小權限原則**
   - 僅允許本機前端來源
   - 僅對 `/api/*` 路徑啟用 CORS
   - 不支援 credentials

### 版本資訊
- Flask-CORS: 6.0.2 (>=6.0.0)
- 修補日期: 2024-12-22

